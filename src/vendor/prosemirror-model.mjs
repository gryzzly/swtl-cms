/* esm.sh - esbuild bundle(prosemirror-model@1.19.4) es2022 production */
import U from"orderedmap";function $(l,t,e){for(let n=0;;n++){if(n==l.childCount||n==t.childCount)return l.childCount==t.childCount?null:e;let i=l.child(n),r=t.child(n);if(i==r){e+=i.nodeSize;continue}if(!i.sameMarkup(r))return e;if(i.isText&&i.text!=r.text){for(let s=0;i.text[s]==r.text[s];s++)e++;return e}if(i.content.size||r.content.size){let s=$(i.content,r.content,e+1);if(s!=null)return s}e+=i.nodeSize}}function tt(l,t,e,n){for(let i=l.childCount,r=t.childCount;;){if(i==0||r==0)return i==r?null:{a:e,b:n};let s=l.child(--i),h=t.child(--r),o=s.nodeSize;if(s==h){e-=o,n-=o;continue}if(!s.sameMarkup(h))return{a:e,b:n};if(s.isText&&s.text!=h.text){let a=0,f=Math.min(s.text.length,h.text.length);for(;a<f&&s.text[s.text.length-a-1]==h.text[h.text.length-a-1];)a++,e--,n--;return{a:e,b:n}}if(s.content.size||h.content.size){let a=tt(s.content,h.content,e-1,n-1);if(a)return a}e-=o,n-=o}}var u=class l{constructor(t,e){if(this.content=t,this.size=e||0,e==null)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,i=0,r){for(let s=0,h=0;h<e;s++){let o=this.content[s],a=h+o.nodeSize;if(a>t&&n(o,i+h,r||null,s)!==!1&&o.content.size){let f=h+1;o.nodesBetween(Math.max(0,t-f),Math.min(o.content.size,e-f),n,i+f)}h=a}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,i){let r="",s=!0;return this.nodesBetween(t,e,(h,o)=>{let a=h.isText?h.text.slice(Math.max(t,o)-o,e-o):h.isLeaf?i?typeof i=="function"?i(h):i:h.type.spec.leafText?h.type.spec.leafText(h):"":"";h.isBlock&&(h.isLeaf&&a||h.isTextblock)&&n&&(s?s=!1:r+=n),r+=a},0),r}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,i=this.content.slice(),r=0;for(e.isText&&e.sameMarkup(n)&&(i[i.length-1]=e.withText(e.text+n.text),r=1);r<t.content.length;r++)i.push(t.content[r]);return new l(i,this.size+t.size)}cut(t,e=this.size){if(t==0&&e==this.size)return this;let n=[],i=0;if(e>t)for(let r=0,s=0;s<e;r++){let h=this.content[r],o=s+h.nodeSize;o>t&&((s<t||o>e)&&(h.isText?h=h.cut(Math.max(0,t-s),Math.min(h.text.length,e-s)):h=h.cut(Math.max(0,t-s-1),Math.min(h.content.size,e-s-1))),n.push(h),i+=h.nodeSize),s=o}return new l(n,i)}cutByIndex(t,e){return t==e?l.empty:t==0&&e==this.content.length?this:new l(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let i=this.content.slice(),r=this.size+e.nodeSize-n.nodeSize;return i[t]=e,new l(i,r)}addToStart(t){return new l([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new l(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let i=this.content[e];t(i,n,e),n+=i.nodeSize}}findDiffStart(t,e=0){return $(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return tt(this,t,e,n)}findIndex(t,e=-1){if(t==0)return O(0,t);if(t==this.size)return O(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,i=0;;n++){let r=this.child(n),s=i+r.nodeSize;if(s>=t)return s==t||e>0?O(n+1,s):O(n,i);i=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(t=>t.toJSON()):null}static fromJSON(t,e){if(!e)return l.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new l(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return l.empty;let e,n=0;for(let i=0;i<t.length;i++){let r=t[i];n+=r.nodeSize,i&&r.isText&&t[i-1].sameMarkup(r)?(e||(e=t.slice(0,i)),e[e.length-1]=r.withText(e[e.length-1].text+r.text)):e&&e.push(r)}return new l(e||t,n)}static from(t){if(!t)return l.empty;if(t instanceof l)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new l([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};u.empty=new u([],0);var I={index:0,offset:0};function O(l,t){return I.index=l,I.offset=t,I}function C(l,t){if(l===t)return!0;if(!(l&&typeof l=="object")||!(t&&typeof t=="object"))return!1;let e=Array.isArray(l);if(Array.isArray(t)!=e)return!1;if(e){if(l.length!=t.length)return!1;for(let n=0;n<l.length;n++)if(!C(l[n],t[n]))return!1}else{for(let n in l)if(!(n in t)||!C(l[n],t[n]))return!1;for(let n in t)if(!(n in l))return!1}return!0}var c=class l{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let i=0;i<t.length;i++){let r=t[i];if(this.eq(r))return t;if(this.type.excludes(r.type))e||(e=t.slice(0,i));else{if(r.type.excludes(this.type))return t;!n&&r.type.rank>this.type.rank&&(e||(e=t.slice(0,i)),e.push(this),n=!0),e&&e.push(r)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&C(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&t.length==0)return l.none;if(t instanceof l)return[t];let e=t.slice();return e.sort((n,i)=>n.type.rank-i.type.rank),e}};c.none=[];var M=class extends Error{},x=class l{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=nt(this.content,t+this.openStart,e);return n&&new l(n,this.openStart,this.openEnd)}removeBetween(t,e){return new l(et(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return l.empty;let n=e.openStart||0,i=e.openEnd||0;if(typeof n!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new l(u.fromJSON(t,e.content),n,i)}static maxOpen(t,e=!0){let n=0,i=0;for(let r=t.firstChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.firstChild)n++;for(let r=t.lastChild;r&&!r.isLeaf&&(e||!r.type.spec.isolating);r=r.lastChild)i++;return new l(t,n,i)}};x.empty=new x(u.empty,0,0);function et(l,t,e){let{index:n,offset:i}=l.findIndex(t),r=l.maybeChild(n),{index:s,offset:h}=l.findIndex(e);if(i==t||r.isText){if(h!=e&&!l.child(s).isText)throw new RangeError("Removing non-flat range");return l.cut(0,t).append(l.cut(e))}if(n!=s)throw new RangeError("Removing non-flat range");return l.replaceChild(n,r.copy(et(r.content,t-i-1,e-i-1)))}function nt(l,t,e,n){let{index:i,offset:r}=l.findIndex(t),s=l.maybeChild(i);if(r==t||s.isText)return n&&!n.canReplace(i,i,e)?null:l.cut(0,t).append(e).append(l.cut(t));let h=nt(s.content,t-r-1,e);return h&&l.replaceChild(i,s.copy(h))}function dt(l,t,e){if(e.openStart>l.depth)throw new M("Inserted content deeper than insertion position");if(l.depth-e.openStart!=t.depth-e.openEnd)throw new M("Inconsistent open depths");return it(l,t,e,0)}function it(l,t,e,n){let i=l.index(n),r=l.node(n);if(i==t.index(n)&&n<l.depth-e.openStart){let s=it(l,t,e,n+1);return r.copy(r.content.replaceChild(i,s))}else if(e.content.size)if(!e.openStart&&!e.openEnd&&l.depth==n&&t.depth==n){let s=l.parent,h=s.content;return m(s,h.cut(0,l.parentOffset).append(e.content).append(h.cut(t.parentOffset)))}else{let{start:s,end:h}=gt(e,l);return m(r,st(l,s,h,t,n))}else return m(r,T(l,t,n))}function rt(l,t){if(!t.type.compatibleContent(l.type))throw new M("Cannot join "+t.type.name+" onto "+l.type.name)}function P(l,t,e){let n=l.node(e);return rt(n,t.node(e)),n}function g(l,t){let e=t.length-1;e>=0&&l.isText&&l.sameMarkup(t[e])?t[e]=l.withText(t[e].text+l.text):t.push(l)}function w(l,t,e,n){let i=(t||l).node(e),r=0,s=t?t.index(e):i.childCount;l&&(r=l.index(e),l.depth>e?r++:l.textOffset&&(g(l.nodeAfter,n),r++));for(let h=r;h<s;h++)g(i.child(h),n);t&&t.depth==e&&t.textOffset&&g(t.nodeBefore,n)}function m(l,t){return l.type.checkContent(t),l.copy(t)}function st(l,t,e,n,i){let r=l.depth>i&&P(l,t,i+1),s=n.depth>i&&P(e,n,i+1),h=[];return w(null,l,i,h),r&&s&&t.index(i)==e.index(i)?(rt(r,s),g(m(r,st(l,t,e,n,i+1)),h)):(r&&g(m(r,T(l,t,i+1)),h),w(t,e,i,h),s&&g(m(s,T(e,n,i+1)),h)),w(n,null,i,h),new u(h)}function T(l,t,e){let n=[];if(w(null,l,e,n),l.depth>e){let i=P(l,t,e+1);g(m(i,T(l,t,e+1)),n)}return w(t,null,e,n),new u(n)}function gt(l,t){let e=t.depth-l.openStart,i=t.node(e).copy(l.content);for(let r=e-1;r>=0;r--)i=t.node(r).copy(u.from(i));return{start:i.resolveNoCache(l.openStart+e),end:i.resolveNoCache(i.content.size-l.openEnd-e)}}var v=class l{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return t==null?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[this.resolveDepth(t)*3]}index(t){return this.path[this.resolveDepth(t)*3+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t==this.depth&&!this.textOffset?0:1)}start(t){return t=this.resolveDepth(t),t==0?0:this.path[t*3-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[t*3-1]+this.path[t*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],i=t.child(e);return n?t.child(e).cut(n):i}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):t==0?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[e*3],i=e==0?0:this.path[e*3-1]+1;for(let r=0;r<t;r++)i+=n.child(r).nodeSize;return i}marks(){let t=this.parent,e=this.index();if(t.content.size==0)return c.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),i=t.maybeChild(e);if(!n){let h=n;n=i,i=h}let r=n.marks;for(var s=0;s<r.length;s++)r[s].type.spec.inclusive===!1&&(!i||!r[s].isInSet(i.marks))&&(r=r[s--].removeFromSet(r));return r}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,i=t.parent.maybeChild(t.index());for(var r=0;r<n.length;r++)n[r].type.spec.inclusive===!1&&(!i||!n[r].isInSet(i.marks))&&(n=n[r--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new B(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],i=0,r=e;for(let s=t;;){let{index:h,offset:o}=s.content.findIndex(r),a=r-o;if(n.push(s,h,i+o),!a||(s=s.child(h),s.isText))break;r=a-1,i+=o+1}return new l(e,n,r)}static resolveCached(t,e){for(let i=0;i<R.length;i++){let r=R[i];if(r.pos==e&&r.doc==t)return r}let n=R[F]=l.resolve(t,e);return F=(F+1)%mt,n}},R=[],F=0,mt=12,B=class{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},xt=Object.create(null),d=class l{constructor(t,e,n,i=c.none){this.type=t,this.attrs=e,this.marks=i,this.content=n||u.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,i=0){this.content.nodesBetween(t,e,n,i,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,i){return this.content.textBetween(t,e,n,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&C(this.attrs,e||t.defaultAttrs||xt)&&c.sameSet(this.marks,n||c.none)}copy(t=null){return t==this.content?this:new l(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new l(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return t==0&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return x.empty;let i=this.resolve(t),r=this.resolve(e),s=n?0:i.sharedDepth(e),h=i.start(s),a=i.node(s).content.cut(i.pos-h,r.pos-h);return new x(a,i.depth-s,r.depth-s)}replace(t,e,n){return dt(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:i}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(i==t||e.isText)return e;t-=i+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(t==0)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let i=this.content.child(e-1);return{node:i,index:e-1,offset:n-i.nodeSize}}resolve(t){return v.resolveCached(this,t)}resolveNoCache(t){return v.resolve(this,t)}rangeHasMark(t,e,n){let i=!1;return e>t&&this.nodesBetween(t,e,r=>(n.isInSet(r.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),lt(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=u.empty,i=0,r=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,i,r),h=s&&s.matchFragment(this.content,e);if(!h||!h.validEnd)return!1;for(let o=i;o<r;o++)if(!this.type.allowsMarks(n.child(o).marks))return!1;return!0}canReplaceWith(t,e,n,i){if(i&&!this.type.allowsMarks(i))return!1;let r=this.contentMatchAt(t).matchType(n),s=r&&r.matchFragment(this.content,e);return s?s.validEnd:!1}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content);let t=c.none;for(let e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!c.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(e=>e.type.name)}`);this.content.forEach(e=>e.check())}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(e=>e.toJSON())),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if(e.type=="text"){if(typeof e.text!="string")throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let i=u.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,i,n)}};d.prototype.text=void 0;var J=class l extends d{constructor(t,e,n,i){if(super(t,e,null,i),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):lt(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new l(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new l(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return t==0&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}};function lt(l,t){for(let e=l.length-1;e>=0;e--)t=l[e].type.name+"("+t+")";return t}var y=class l{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new q(t,e);if(n.next==null)return l.empty;let i=ht(n);n.next&&n.err("Unexpected trailing text");let r=Ot(Et(i));return Ct(r,n),r}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let i=this;for(let r=e;i&&r<n;r++)i=i.matchType(t.child(r).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!(e.isText||e.hasRequiredAttrs()))return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let i=[this];function r(s,h){let o=s.matchFragment(t,n);if(o&&(!e||o.validEnd))return u.from(h.map(a=>a.createAndFill()));for(let a=0;a<s.next.length;a++){let{type:f,next:p}=s.next[a];if(!(f.isText||f.hasRequiredAttrs())&&i.indexOf(p)==-1){i.push(p);let E=r(p,h.concat(f));if(E)return E}}return null}return r(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let i=n.shift(),r=i.match;if(r.matchType(t)){let s=[];for(let h=i;h.type;h=h.via)s.push(h.type);return s.reverse()}for(let s=0;s<r.next.length;s++){let{type:h,next:o}=r.next[s];!h.isLeaf&&!h.hasRequiredAttrs()&&!(h.name in e)&&(!i.type||o.validEnd)&&(n.push({match:h.contentMatch,type:h,via:i}),e[h.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let i=0;i<n.next.length;i++)t.indexOf(n.next[i].next)==-1&&e(n.next[i].next)}return e(this),t.map((n,i)=>{let r=i+(n.validEnd?"*":" ")+" ";for(let s=0;s<n.next.length;s++)r+=(s?", ":"")+n.next[s].type.name+"->"+t.indexOf(n.next[s].next);return r}).join(`
`)}};y.empty=new y(!0);var q=class{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}};function ht(l){let t=[];do t.push(yt(l));while(l.eat("|"));return t.length==1?t[0]:{type:"choice",exprs:t}}function yt(l){let t=[];do t.push(kt(l));while(l.next&&l.next!=")"&&l.next!="|");return t.length==1?t[0]:{type:"seq",exprs:t}}function kt(l){let t=Mt(l);for(;;)if(l.eat("+"))t={type:"plus",expr:t};else if(l.eat("*"))t={type:"star",expr:t};else if(l.eat("?"))t={type:"opt",expr:t};else if(l.eat("{"))t=wt(l,t);else break;return t}function V(l){/\D/.test(l.next)&&l.err("Expected number, got '"+l.next+"'");let t=Number(l.next);return l.pos++,t}function wt(l,t){let e=V(l),n=e;return l.eat(",")&&(l.next!="}"?n=V(l):n=-1),l.eat("}")||l.err("Unclosed braced range"),{type:"range",min:e,max:n,expr:t}}function St(l,t){let e=l.nodeTypes,n=e[t];if(n)return[n];let i=[];for(let r in e){let s=e[r];s.groups.indexOf(t)>-1&&i.push(s)}return i.length==0&&l.err("No node type or group '"+t+"' found"),i}function Mt(l){if(l.eat("(")){let t=ht(l);return l.eat(")")||l.err("Missing closing paren"),t}else if(/\W/.test(l.next))l.err("Unexpected token '"+l.next+"'");else{let t=St(l,l.next).map(e=>(l.inline==null?l.inline=e.isInline:l.inline!=e.isInline&&l.err("Mixing inline and block content"),{type:"name",value:e}));return l.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function Et(l){let t=[[]];return i(r(l,0),e()),t;function e(){return t.push([])-1}function n(s,h,o){let a={term:o,to:h};return t[s].push(a),a}function i(s,h){s.forEach(o=>o.to=h)}function r(s,h){if(s.type=="choice")return s.exprs.reduce((o,a)=>o.concat(r(a,h)),[]);if(s.type=="seq")for(let o=0;;o++){let a=r(s.exprs[o],h);if(o==s.exprs.length-1)return a;i(a,h=e())}else if(s.type=="star"){let o=e();return n(h,o),i(r(s.expr,o),o),[n(o)]}else if(s.type=="plus"){let o=e();return i(r(s.expr,h),o),i(r(s.expr,o),o),[n(o)]}else{if(s.type=="opt")return[n(h)].concat(r(s.expr,h));if(s.type=="range"){let o=h;for(let a=0;a<s.min;a++){let f=e();i(r(s.expr,o),f),o=f}if(s.max==-1)i(r(s.expr,o),o);else for(let a=s.min;a<s.max;a++){let f=e();n(o,f),i(r(s.expr,o),f),o=f}return[n(o)]}else{if(s.type=="name")return[n(h,void 0,s.value)];throw new Error("Unknown expr type")}}}}function ot(l,t){return t-l}function H(l,t){let e=[];return n(t),e.sort(ot);function n(i){let r=l[i];if(r.length==1&&!r[0].term)return n(r[0].to);e.push(i);for(let s=0;s<r.length;s++){let{term:h,to:o}=r[s];!h&&e.indexOf(o)==-1&&n(o)}}}function Ot(l){let t=Object.create(null);return e(H(l,0));function e(n){let i=[];n.forEach(s=>{l[s].forEach(({term:h,to:o})=>{if(!h)return;let a;for(let f=0;f<i.length;f++)i[f][0]==h&&(a=i[f][1]);H(l,o).forEach(f=>{a||i.push([h,a=[]]),a.indexOf(f)==-1&&a.push(f)})})});let r=t[n.join(",")]=new y(n.indexOf(l.length-1)>-1);for(let s=0;s<i.length;s++){let h=i[s][1].sort(ot);r.next.push({type:i[s][0],next:t[h.join(",")]||e(h)})}return r}}function Ct(l,t){for(let e=0,n=[l];e<n.length;e++){let i=n[e],r=!i.validEnd,s=[];for(let h=0;h<i.next.length;h++){let{type:o,next:a}=i.next[h];s.push(o.name),r&&!(o.isText||o.hasRequiredAttrs())&&(r=!1),n.indexOf(a)==-1&&n.push(a)}r&&t.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function at(l){let t=Object.create(null);for(let e in l){let n=l[e];if(!n.hasDefault)return null;t[e]=n.default}return t}function ft(l,t){let e=Object.create(null);for(let n in l){let i=t&&t[n];if(i===void 0){let r=l[n];if(r.hasDefault)i=r.default;else throw new RangeError("No value supplied for attribute "+n)}e[n]=i}return e}function ct(l){let t=Object.create(null);if(l)for(let e in l)t[e]=new L(l[e]);return t}var b=class l{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=ct(n.attrs),this.defaultAttrs=at(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||t=="text"),this.isText=t=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==y.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:ft(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new d(this,this.computeAttrs(t),u.from(e),c.setFrom(n))}createChecked(t=null,e,n){return e=u.from(e),this.checkContent(e),new d(this,this.computeAttrs(t),e,c.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),e=u.from(e),e.size){let s=this.contentMatch.fillBefore(e);if(!s)return null;e=s.append(e)}let i=this.contentMatch.matchFragment(e),r=i&&i.fillBefore(u.empty,!0);return r?new d(this,t,e.append(r),c.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}allowsMarkType(t){return this.markSet==null||this.markSet.indexOf(t)>-1}allowsMarks(t){if(this.markSet==null)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(this.markSet==null)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:c.none:t}static compile(t,e){let n=Object.create(null);t.forEach((r,s)=>n[r]=new l(r,e,s));let i=e.spec.topNode||"doc";if(!n[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let r in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}},L=class{constructor(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default}get isRequired(){return!this.hasDefault}},j=class l{constructor(t,e,n,i){this.name=t,this.rank=e,this.schema=n,this.spec=i,this.attrs=ct(i.attrs),this.excluded=null;let r=at(this.attrs);this.instance=r?new c(this,r):null}create(t=null){return!t&&this.instance?this.instance:new c(this,ft(this.attrs,t))}static compile(t,e){let n=Object.create(null),i=0;return t.forEach((r,s)=>n[r]=new l(r,i++,e,s)),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}excludes(t){return this.excluded.indexOf(t)>-1}},G=class{constructor(t){this.cached=Object.create(null);let e=this.spec={};for(let i in t)e[i]=t[i];e.nodes=U.from(t.nodes),e.marks=U.from(t.marks||{}),this.nodes=b.compile(this.spec.nodes,this),this.marks=j.compile(this.spec.marks,this);let n=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let r=this.nodes[i],s=r.spec.content||"",h=r.spec.marks;r.contentMatch=n[s]||(n[s]=y.parse(s,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.markSet=h=="_"?null:h?K(this,h.split(" ")):h==""||!r.inlineContent?[]:null}for(let i in this.marks){let r=this.marks[i],s=r.spec.excludes;r.excluded=s==null?[r]:s==""?[]:K(this,s.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,i){if(typeof t=="string")t=this.nodeType(t);else if(t instanceof b){if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}else throw new RangeError("Invalid node type: "+t);return t.createChecked(e,n,i)}text(t,e){let n=this.nodes.text;return new J(n,n.defaultAttrs,t,c.setFrom(e))}mark(t,e){return typeof t=="string"&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return d.fromJSON(this,t)}markFromJSON(t){return c.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}};function K(l,t){let e=[];for(let n=0;n<t.length;n++){let i=t[n],r=l.marks[i],s=r;if(r)e.push(r);else for(let h in l.marks){let o=l.marks[h];(i=="_"||o.spec.group&&o.spec.group.split(" ").indexOf(i)>-1)&&e.push(s=o)}if(!s)throw new SyntaxError("Unknown mark type: '"+t[n]+"'")}return e}var Q=class l{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach(n=>{n.tag?this.tags.push(n):n.style&&this.styles.push(n)}),this.normalizeLists=!this.tags.some(n=>{if(!/^(ul|ol)\b/.test(n.tag)||!n.node)return!1;let i=t.nodes[n.node];return i.contentMatch.matchType(i)})}parse(t,e={}){let n=new A(this,e,!1);return n.addAll(t,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new A(this,e,!0);return n.addAll(t,e.from,e.to),x.maxOpen(n.finish())}matchTag(t,e,n){for(let i=n?this.tags.indexOf(n)+1:0;i<this.tags.length;i++){let r=this.tags[i];if(bt(t,r.tag)&&(r.namespace===void 0||t.namespaceURI==r.namespace)&&(!r.context||e.matchesContext(r.context))){if(r.getAttrs){let s=r.getAttrs(t);if(s===!1)continue;r.attrs=s||void 0}return r}}}matchStyle(t,e,n,i){for(let r=i?this.styles.indexOf(i)+1:0;r<this.styles.length;r++){let s=this.styles[r],h=s.style;if(!(h.indexOf(t)!=0||s.context&&!n.matchesContext(s.context)||h.length>t.length&&(h.charCodeAt(t.length)!=61||h.slice(t.length+1)!=e))){if(s.getAttrs){let o=s.getAttrs(e);if(o===!1)continue;s.attrs=o||void 0}return s}}}static schemaRules(t){let e=[];function n(i){let r=i.priority==null?50:i.priority,s=0;for(;s<e.length;s++){let h=e[s];if((h.priority==null?50:h.priority)<r)break}e.splice(s,0,i)}for(let i in t.marks){let r=t.marks[i].spec.parseDOM;r&&r.forEach(s=>{n(s=Y(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in t.nodes){let r=t.nodes[i].spec.parseDOM;r&&r.forEach(s=>{n(s=Y(s)),s.node||s.ignore||s.mark||(s.node=i)})}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new l(t,l.schemaRules(t)))}},ut={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Tt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},pt={ol:!0,ul:!0},z=1,N=2,S=4;function X(l,t,e){return t!=null?(t?z:0)|(t==="full"?N:0):l&&l.whitespace=="pre"?z|N:e&~S}var k=class{constructor(t,e,n,i,r,s,h){this.type=t,this.attrs=e,this.marks=n,this.pendingMarks=i,this.solid=r,this.options=h,this.content=[],this.activeMarks=c.none,this.stashMarks=[],this.match=s||(h&S?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(u.from(t));if(e)this.match=this.type.contentMatch.matchFragment(e);else{let n=this.type.contentMatch,i;return(i=n.findWrapping(t.type))?(this.match=n,i):null}}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&z)){let n=this.content[this.content.length-1],i;if(n&&n.isText&&(i=/[ \t\r\n\u000c]+$/.exec(n.text))){let r=n;n.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-i[0].length))}}let e=u.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(u.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,n=this.pendingMarks;e<n.length;e++){let i=n[e];(this.type?this.type.allowsMarkType(i.type):Nt(i.type,t))&&!i.isInSet(this.activeMarks)&&(this.activeMarks=i.addToSet(this.activeMarks),this.pendingMarks=i.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!ut.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}},A=class{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let i=e.topNode,r,s=X(null,e.preserveWhitespace,0)|(n?S:0);i?r=new k(i.type,i.attrs,c.none,c.none,!0,e.topMatch||i.type.contentMatch,s):n?r=new k(null,null,c.none,c.none,!0,null,s):r=new k(t.schema.topNodeType,null,c.none,c.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){t.nodeType==3?this.addTextNode(t):t.nodeType==1&&this.addElement(t)}withStyleRules(t,e){let n=t.getAttribute("style");if(!n)return e();let i=this.readStyles(zt(n));if(!i)return;let[r,s]=i,h=this.top;for(let o=0;o<s.length;o++)this.removePendingMark(s[o],h);for(let o=0;o<r.length;o++)this.addPendingMark(r[o]);e();for(let o=0;o<r.length;o++)this.removePendingMark(r[o],h);for(let o=0;o<s.length;o++)this.addPendingMark(s[o])}addTextNode(t){let e=t.nodeValue,n=this.top;if(n.options&N||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&z)n.options&N?e=e.replace(/\r\n?/g,`
`):e=e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let i=n.content[n.content.length-1],r=t.previousSibling;(!i||r&&r.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let n=t.nodeName.toLowerCase(),i;pt.hasOwnProperty(n)&&this.parser.normalizeLists&&vt(t);let r=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,e));if(r?r.ignore:Tt.hasOwnProperty(n))this.findInside(t),this.ignoreFallback(t);else if(!r||r.skip||r.closeParent){r&&r.closeParent?this.open=Math.max(0,this.open-1):r&&r.skip.nodeType&&(t=r.skip);let s,h=this.top,o=this.needsBlock;if(ut.hasOwnProperty(n))h.content.length&&h.content[0].isInline&&this.open&&(this.open--,h=this.top),s=!0,h.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t);return}r&&r.skip?this.addAll(t):this.withStyleRules(t,()=>this.addAll(t)),s&&this.sync(h),this.needsBlock=o}else this.withStyleRules(t,()=>{this.addElementByRule(t,r,r.consuming===!1?i:void 0)})}leafFallback(t){t.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode(`
`))}ignoreFallback(t){t.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=c.none,n=c.none;for(let i=0;i<t.length;i+=2)for(let r=void 0;;){let s=this.parser.matchStyle(t[i],t[i+1],this,r);if(!s)break;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach(h=>{s.clearMark(h)&&(n=h.addToSet(n))}):e=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(e),s.consuming===!1)r=s;else break}return[e,n]}addElementByRule(t,e,n){let i,r,s;e.node?(r=this.parser.schema.nodes[e.node],r.isLeaf?this.insertNode(r.create(e.attrs))||this.leafFallback(t):i=this.enter(r,e.attrs||null,e.preserveWhitespace)):(s=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(s));let h=this.top;if(r&&r.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(o=>this.insertNode(o));else{let o=t;typeof e.contentElement=="string"?o=t.querySelector(e.contentElement):typeof e.contentElement=="function"?o=e.contentElement(t):e.contentElement&&(o=e.contentElement),this.findAround(t,o,!0),this.addAll(o)}i&&this.sync(h)&&this.open--,s&&this.removePendingMark(s,h)}addAll(t,e,n){let i=e||0;for(let r=e?t.childNodes[e]:t.firstChild,s=n==null?null:t.childNodes[n];r!=s;r=r.nextSibling,++i)this.findAtPoint(t,i),this.addDOM(r);this.findAtPoint(t,i)}findPlace(t){let e,n;for(let i=this.open;i>=0;i--){let r=this.nodes[i],s=r.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,n=r,!s.length)||r.solid)break}if(!e)return!1;this.sync(n);for(let i=0;i<e.length;i++)this.enterInner(e[i],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let n=e.activeMarks;for(let i=0;i<t.marks.length;i++)(!e.type||e.type.allowsMarkType(t.marks[i].type))&&(n=t.marks[i].addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n){let i=this.findPlace(t.create(e));return i&&this.enterInner(t,e,!0,n),i}enterInner(t,e=null,n=!1,i){this.closeExtra();let r=this.top;r.applyPending(t),r.match=r.match&&r.match.matchType(t);let s=X(t,i,r.options);r.options&S&&r.content.length==0&&(s|=S),this.nodes.push(new k(t,e,r.activeMarks,r.pendingMarks,n,null,s)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let i=n.length-1;i>=0;i--)t+=n[i].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].pos==null&&t.nodeType==1&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&t.nodeType==1&&t.contains(this.find[i].node)&&e.compareDocumentPosition(this.find[i].node)&(n?2:4)&&(this.find[i].pos=this.currentPos)}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,i=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),r=-(n?n.depth+1:0)+(i?0:1),s=(h,o)=>{for(;h>=0;h--){let a=e[h];if(a==""){if(h==e.length-1||h==0)continue;for(;o>=r;o--)if(s(h-1,o))return!0;return!1}else{let f=o>0||o==0&&i?this.nodes[o].type:n&&o>=r?n.node(o-r).type:null;if(!f||f.name!=a&&f.groups.indexOf(a)==-1)return!1;o--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let n=this.parser.schema.nodes[e];if(n.isTextblock&&n.defaultAttrs)return n}}addPendingMark(t){let e=At(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let n=this.open;n>=0;n--){let i=this.nodes[n];if(i.pendingMarks.lastIndexOf(t)>-1)i.pendingMarks=t.removeFromSet(i.pendingMarks);else{i.activeMarks=t.removeFromSet(i.activeMarks);let s=i.popFromStashMark(t);s&&i.type&&i.type.allowsMarkType(s.type)&&(i.activeMarks=s.addToSet(i.activeMarks))}if(i==e)break}}};function vt(l){for(let t=l.firstChild,e=null;t;t=t.nextSibling){let n=t.nodeType==1?t.nodeName.toLowerCase():null;n&&pt.hasOwnProperty(n)&&e?(e.appendChild(t),t=e):n=="li"?e=t:n&&(e=null)}}function bt(l,t){return(l.matches||l.msMatchesSelector||l.webkitMatchesSelector||l.mozMatchesSelector).call(l,t)}function zt(l){let t=/\s*([\w-]+)\s*:\s*([^;]+)/g,e,n=[];for(;e=t.exec(l);)n.push(e[1],e[2].trim());return n}function Y(l){let t={};for(let e in l)t[e]=l[e];return t}function Nt(l,t){let e=t.schema.nodes;for(let n in e){let i=e[n];if(!i.allowsMarkType(l))continue;let r=[],s=h=>{r.push(h);for(let o=0;o<h.edgeCount;o++){let{type:a,next:f}=h.edge(o);if(a==t||r.indexOf(f)<0&&s(f))return!0}};if(s(i.contentMatch))return!0}}function At(l,t){for(let e=0;e<t.length;e++)if(l.eq(t[e]))return t[e]}var Z=class l{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=D(e).createDocumentFragment());let i=n,r=[];return t.forEach(s=>{if(r.length||s.marks.length){let h=0,o=0;for(;h<r.length&&o<s.marks.length;){let a=s.marks[o];if(!this.marks[a.type.name]){o++;continue}if(!a.eq(r[h][0])||a.type.spec.spanning===!1)break;h++,o++}for(;h<r.length;)i=r.pop()[1];for(;o<s.marks.length;){let a=s.marks[o++],f=this.serializeMark(a,s.isInline,e);f&&(r.push([a,i]),i.appendChild(f.dom),i=f.contentDOM||f.dom)}}i.appendChild(this.serializeNodeInner(s,e))}),n}serializeNodeInner(t,e){let{dom:n,contentDOM:i}=l.renderSpec(D(e),this.nodes[t.type.name](t));if(i){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,i)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let i=t.marks.length-1;i>=0;i--){let r=this.serializeMark(t.marks[i],t.isInline,e);r&&((r.contentDOM||r.dom).appendChild(n),n=r.dom)}return n}serializeMark(t,e,n={}){let i=this.marks[t.type.name];return i&&l.renderSpec(D(n),i(t,e))}static renderSpec(t,e,n=null){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],r=i.indexOf(" ");r>0&&(n=i.slice(0,r),i=i.slice(r+1));let s,h=n?t.createElementNS(n,i):t.createElement(i),o=e[1],a=1;if(o&&typeof o=="object"&&o.nodeType==null&&!Array.isArray(o)){a=2;for(let f in o)if(o[f]!=null){let p=f.indexOf(" ");p>0?h.setAttributeNS(f.slice(0,p),f.slice(p+1),o[f]):h.setAttribute(f,o[f])}}for(let f=a;f<e.length;f++){let p=e[f];if(p===0){if(f<e.length-1||f>a)throw new RangeError("Content hole must be the only child of its parent node");return{dom:h,contentDOM:h}}else{let{dom:E,contentDOM:W}=l.renderSpec(t,p,n);if(h.appendChild(E),W){if(s)throw new RangeError("Multiple content holes");s=W}}}return{dom:h,contentDOM:s}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new l(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=_(t.nodes);return e.text||(e.text=n=>n.text),e}static marksFromSchema(t){return _(t.marks)}};function _(l){let t={};for(let e in l){let n=l[e].spec.toDOM;n&&(t[e]=n)}return t}function D(l){return l.document||window.document}export{y as ContentMatch,Q as DOMParser,Z as DOMSerializer,u as Fragment,c as Mark,j as MarkType,d as Node,B as NodeRange,b as NodeType,M as ReplaceError,v as ResolvedPos,G as Schema,x as Slice};
//# sourceMappingURL=prosemirror-model.mjs.map