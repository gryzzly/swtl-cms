/* esm.sh - esbuild bundle(prosemirror-commands@1.5.2) es2022 production */
import{liftTarget as I,replaceStep as V,ReplaceStep as G,canJoin as A,joinPoint as F,canSplit as B,ReplaceAroundStep as D,findWrapping as H}from"prosemirror-transform";import{Slice as S,Fragment as y}from"prosemirror-model";import{NodeSelection as k,Selection as C,TextSelection as M,AllSelection as z}from"prosemirror-state";var E=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function P(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("backward",t):r.parentOffset>0)?null:r}var U=(t,e,r)=>{let n=P(t,r);if(!n)return!1;let o=j(n);if(!o){let i=n.blockRange(),f=i&&I(i);return f==null?!1:(e&&e(t.tr.lift(i,f).scrollIntoView()),!0)}let l=o.nodeBefore;if(!l.type.spec.isolating&&J(t,o,e))return!0;if(n.parent.content.size==0&&(x(l,"end")||k.isSelectable(l))){let i=V(t.doc,n.before(),n.after(),S.empty);if(i&&i.slice.size<i.to-i.from){if(e){let f=t.tr.step(i);f.setSelection(x(l,"end")?C.findFrom(f.doc.resolve(f.mapping.map(o.pos,-1)),-1):k.create(f.doc,o.pos-l.nodeSize)),e(f.scrollIntoView())}return!0}}return l.isAtom&&o.depth==n.depth-1?(e&&e(t.tr.delete(o.pos-l.nodeSize,o.pos).scrollIntoView()),!0):!1},de=(t,e,r)=>{let n=P(t,r);if(!n)return!1;let o=j(n);return o?W(t,o,e):!1},me=(t,e,r)=>{let n=N(t,r);if(!n)return!1;let o=O(n);return o?W(t,o,e):!1};function W(t,e,r){let n=e.nodeBefore,o=n,l=e.pos-1;for(;!o.isTextblock;l--){if(o.type.spec.isolating)return!1;let c=o.lastChild;if(!c)return!1;o=c}let i=e.nodeAfter,f=i,s=e.pos+1;for(;!f.isTextblock;s++){if(f.type.spec.isolating)return!1;let c=f.firstChild;if(!c)return!1;f=c}let a=V(t.doc,l,s,S.empty);if(!a||a.from!=l||a instanceof G&&a.slice.size>=s-l)return!1;if(r){let c=t.tr.step(a);c.setSelection(M.create(c.doc,l)),r(c.scrollIntoView())}return!0}function x(t,e,r=!1){for(let n=t;n;n=e=="start"?n.firstChild:n.lastChild){if(n.isTextblock)return!0;if(r&&n.childCount!=1)return!1}return!1}var L=(t,e,r)=>{let{$head:n,empty:o}=t.selection,l=n;if(!o)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("backward",t):n.parentOffset>0)return!1;l=j(n)}let i=l&&l.nodeBefore;return!i||!k.isSelectable(i)?!1:(e&&e(t.tr.setSelection(k.create(t.doc,l.pos-i.nodeSize)).scrollIntoView()),!0)};function j(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function N(t,e){let{$cursor:r}=t.selection;return!r||(e?!e.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)?null:r}var Q=(t,e,r)=>{let n=N(t,r);if(!n)return!1;let o=O(n);if(!o)return!1;let l=o.nodeAfter;if(J(t,o,e))return!0;if(n.parent.content.size==0&&(x(l,"start")||k.isSelectable(l))){let i=V(t.doc,n.before(),n.after(),S.empty);if(i&&i.slice.size<i.to-i.from){if(e){let f=t.tr.step(i);f.setSelection(x(l,"start")?C.findFrom(f.doc.resolve(f.mapping.map(o.pos)),1):k.create(f.doc,f.mapping.map(o.pos))),e(f.scrollIntoView())}return!0}}return l.isAtom&&o.depth==n.depth-1?(e&&e(t.tr.delete(o.pos,o.pos+l.nodeSize).scrollIntoView()),!0):!1},X=(t,e,r)=>{let{$head:n,empty:o}=t.selection,l=n;if(!o)return!1;if(n.parent.isTextblock){if(r?!r.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)return!1;l=O(n)}let i=l&&l.nodeAfter;return!i||!k.isSelectable(i)?!1:(e&&e(t.tr.setSelection(k.create(t.doc,l.pos)).scrollIntoView()),!0)};function O(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let r=t.node(e);if(t.index(e)+1<r.childCount)return t.doc.resolve(t.after(e+1));if(r.type.spec.isolating)break}return null}var ke=(t,e)=>{let r=t.selection,n=r instanceof k,o;if(n){if(r.node.isTextblock||!A(t.doc,r.from))return!1;o=r.from}else if(o=F(t.doc,r.from,-1),o==null)return!1;if(e){let l=t.tr.join(o);n&&l.setSelection(k.create(l.doc,o-t.doc.resolve(o).nodeBefore.nodeSize)),e(l.scrollIntoView())}return!0},ge=(t,e)=>{let r=t.selection,n;if(r instanceof k){if(r.node.isTextblock||!A(t.doc,r.to))return!1;n=r.to}else if(n=F(t.doc,r.to,1),n==null)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},be=(t,e)=>{let{$from:r,$to:n}=t.selection,o=r.blockRange(n),l=o&&I(o);return l==null?!1:(e&&e(t.tr.lift(o,l).scrollIntoView()),!0)},Y=(t,e)=>{let{$head:r,$anchor:n}=t.selection;return!r.parent.type.spec.code||!r.sameParent(n)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function R(t){for(let e=0;e<t.edgeCount;e++){let{type:r}=t.edge(e);if(r.isTextblock&&!r.hasRequiredAttrs())return r}return null}var Z=(t,e)=>{let{$head:r,$anchor:n}=t.selection;if(!r.parent.type.spec.code||!r.sameParent(n))return!1;let o=r.node(-1),l=r.indexAfter(-1),i=R(o.contentMatchAt(l));if(!i||!o.canReplaceWith(l,l,i))return!1;if(e){let f=r.after(),s=t.tr.replaceWith(f,f,i.createAndFill());s.setSelection(C.near(s.doc.resolve(f),1)),e(s.scrollIntoView())}return!0},ee=(t,e)=>{let r=t.selection,{$from:n,$to:o}=r;if(r instanceof z||n.parent.inlineContent||o.parent.inlineContent)return!1;let l=R(o.parent.contentMatchAt(o.indexAfter()));if(!l||!l.isTextblock)return!1;if(e){let i=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos,f=t.tr.insert(i,l.createAndFill());f.setSelection(M.create(f.doc,i+1)),e(f.scrollIntoView())}return!0},te=(t,e)=>{let{$cursor:r}=t.selection;if(!r||r.parent.content.size)return!1;if(r.depth>1&&r.after()!=r.end(-1)){let l=r.before();if(B(t.doc,l))return e&&e(t.tr.split(l).scrollIntoView()),!0}let n=r.blockRange(),o=n&&I(n);return o==null?!1:(e&&e(t.tr.lift(n,o).scrollIntoView()),!0)};function re(t){return(e,r)=>{let{$from:n,$to:o}=e.selection;if(e.selection instanceof k&&e.selection.node.isBlock)return!n.parentOffset||!B(e.doc,n.pos)?!1:(r&&r(e.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(r){let l=o.parentOffset==o.parent.content.size,i=e.tr;(e.selection instanceof M||e.selection instanceof z)&&i.deleteSelection();let f=n.depth==0?null:R(n.node(-1).contentMatchAt(n.indexAfter(-1))),s=t&&t(o.parent,l),a=s?[s]:l&&f?[{type:f}]:void 0,c=B(i.doc,i.mapping.map(n.pos),1,a);if(!a&&!c&&B(i.doc,i.mapping.map(n.pos),1,f?[{type:f}]:void 0)&&(f&&(a=[{type:f}]),c=!0),c&&(i.split(i.mapping.map(n.pos),1,a),!l&&!n.parentOffset&&n.parent.type!=f)){let u=i.mapping.map(n.before()),p=i.doc.resolve(u);f&&n.node(-1).canReplaceWith(p.index(),p.index()+1,f)&&i.setNodeMarkup(i.mapping.map(n.before()),f)}r(i.scrollIntoView())}return!0}}var K=re(),xe=(t,e)=>K(t,e&&(r=>{let n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();n&&r.ensureMarks(n),e(r)})),we=(t,e)=>{let{$from:r,to:n}=t.selection,o,l=r.sharedDepth(n);return l==0?!1:(o=r.before(l),e&&e(t.tr.setSelection(k.create(t.doc,o))),!0)},ne=(t,e)=>(e&&e(t.tr.setSelection(new z(t.doc))),!0);function oe(t,e,r){let n=e.nodeBefore,o=e.nodeAfter,l=e.index();return!n||!o||!n.type.compatibleContent(o.type)?!1:!n.content.size&&e.parent.canReplace(l-1,l)?(r&&r(t.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(l,l+1)||!(o.isTextblock||A(t.doc,e.pos))?!1:(r&&r(t.tr.clearIncompatible(e.pos,n.type,n.contentMatchAt(n.childCount)).join(e.pos).scrollIntoView()),!0)}function J(t,e,r){let n=e.nodeBefore,o=e.nodeAfter,l,i;if(n.type.spec.isolating||o.type.spec.isolating)return!1;if(oe(t,e,r))return!0;let f=e.parent.canReplace(e.index(),e.index()+1);if(f&&(l=(i=n.contentMatchAt(n.childCount)).findWrapping(o.type))&&i.matchType(l[0]||o.type).validEnd){if(r){let u=e.pos+o.nodeSize,p=y.empty;for(let g=l.length-1;g>=0;g--)p=y.from(l[g].create(null,p));p=y.from(n.copy(p));let d=t.tr.step(new D(e.pos-1,u,e.pos,u,new S(p,1,0),l.length,!0)),m=u+2*l.length;A(d.doc,m)&&d.join(m),r(d.scrollIntoView())}return!0}let s=C.findFrom(e,1),a=s&&s.$from.blockRange(s.$to),c=a&&I(a);if(c!=null&&c>=e.depth)return r&&r(t.tr.lift(a,c).scrollIntoView()),!0;if(f&&x(o,"start",!0)&&x(n,"end")){let u=n,p=[];for(;p.push(u),!u.isTextblock;)u=u.lastChild;let d=o,m=1;for(;!d.isTextblock;d=d.firstChild)m++;if(u.canReplace(u.childCount,u.childCount,d.content)){if(r){let g=y.empty;for(let w=p.length-1;w>=0;w--)g=y.from(p[w].copy(g));let h=t.tr.step(new D(e.pos-p.length,e.pos+o.nodeSize,e.pos+m,e.pos+o.nodeSize-m,new S(g,p.length,0),0,!0));r(h.scrollIntoView())}return!0}}return!1}function _(t){return function(e,r){let n=e.selection,o=t<0?n.$from:n.$to,l=o.depth;for(;o.node(l).isInline;){if(!l)return!1;l--}return o.node(l).isTextblock?(r&&r(e.tr.setSelection(M.create(e.doc,t<0?o.start(l):o.end(l)))),!0):!1}}var le=_(-1),ie=_(1);function ye(t,e=null){return function(r,n){let{$from:o,$to:l}=r.selection,i=o.blockRange(l),f=i&&H(i,t,e);return f?(n&&n(r.tr.wrap(i,f).scrollIntoView()),!0):!1}}function Se(t,e=null){return function(r,n){let o=!1;for(let l=0;l<r.selection.ranges.length&&!o;l++){let{$from:{pos:i},$to:{pos:f}}=r.selection.ranges[l];r.doc.nodesBetween(i,f,(s,a)=>{if(o)return!1;if(!(!s.isTextblock||s.hasMarkup(t,e)))if(s.type==t)o=!0;else{let c=r.doc.resolve(a),u=c.index();o=c.parent.canReplaceWith(u,u+1,t)}})}if(!o)return!1;if(n){let l=r.tr;for(let i=0;i<r.selection.ranges.length;i++){let{$from:{pos:f},$to:{pos:s}}=r.selection.ranges[i];l.setBlockType(f,s,t,e)}n(l.scrollIntoView())}return!0}}function fe(t,e,r){for(let n=0;n<e.length;n++){let{$from:o,$to:l}=e[n],i=o.depth==0?t.inlineContent&&t.type.allowsMarkType(r):!1;if(t.nodesBetween(o.pos,l.pos,f=>{if(i)return!1;i=f.inlineContent&&f.type.allowsMarkType(r)}),i)return!0}return!1}function Ae(t,e=null){return function(r,n){let{empty:o,$cursor:l,ranges:i}=r.selection;if(o&&!l||!fe(r.doc,i,t))return!1;if(n)if(l)t.isInSet(r.storedMarks||l.marks())?n(r.tr.removeStoredMark(t)):n(r.tr.addStoredMark(t.create(e)));else{let f=!1,s=r.tr;for(let a=0;!f&&a<i.length;a++){let{$from:c,$to:u}=i[a];f=r.doc.rangeHasMark(c.pos,u.pos,t)}for(let a=0;a<i.length;a++){let{$from:c,$to:u}=i[a];if(f)s.removeMark(c.pos,u.pos,t);else{let p=c.pos,d=u.pos,m=c.nodeAfter,g=u.nodeBefore,h=m&&m.isText?/^\s*/.exec(m.text)[0].length:0,w=g&&g.isText?/\s*$/.exec(g.text)[0].length:0;p+h<d&&(p+=h,d-=w),s.addMark(p,d,t.create(e))}}n(s.scrollIntoView())}return!0}}function ce(t,e){return r=>{if(!r.isGeneric)return t(r);let n=[];for(let l=0;l<r.mapping.maps.length;l++){let i=r.mapping.maps[l];for(let f=0;f<n.length;f++)n[f]=i.map(n[f]);i.forEach((f,s,a,c)=>n.push(a,c))}let o=[];for(let l=0;l<n.length;l+=2){let i=n[l],f=n[l+1],s=r.doc.resolve(i),a=s.sharedDepth(f),c=s.node(a);for(let u=s.indexAfter(a),p=s.after(a+1);p<=f;++u){let d=c.maybeChild(u);if(!d)break;if(u&&o.indexOf(p)==-1){let m=c.child(u-1);m.type==d.type&&e(m,d)&&o.push(p)}p+=d.nodeSize}}o.sort((l,i)=>l-i);for(let l=o.length-1;l>=0;l--)A(r.doc,o[l])&&r.join(o[l]);t(r)}}function he(t,e){let r=Array.isArray(e)?n=>e.indexOf(n.type.name)>-1:e;return(n,o,l)=>t(n,o&&ce(o,r),l)}function $(...t){return function(e,r,n){for(let o=0;o<t.length;o++)if(t[o](e,r,n))return!0;return!1}}var T=$(E,U,L),v=$(E,Q,X),b={Enter:$(Y,ee,te,K),"Mod-Enter":Z,Backspace:T,"Mod-Backspace":T,"Shift-Backspace":T,Delete:v,"Mod-Delete":v,"Mod-a":ne},q={"Ctrl-h":b.Backspace,"Alt-Backspace":b["Mod-Backspace"],"Ctrl-d":b.Delete,"Ctrl-Alt-Backspace":b["Mod-Delete"],"Alt-Delete":b["Mod-Delete"],"Alt-d":b["Mod-Delete"],"Ctrl-a":le,"Ctrl-e":ie};for(let t in b)q[t]=b[t];var se=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1,Be=se?q:b;export{he as autoJoin,Be as baseKeymap,$ as chainCommands,ee as createParagraphNear,E as deleteSelection,Z as exitCode,U as joinBackward,ge as joinDown,Q as joinForward,de as joinTextblockBackward,me as joinTextblockForward,ke as joinUp,be as lift,te as liftEmptyBlock,q as macBaseKeymap,Y as newlineInCode,b as pcBaseKeymap,ne as selectAll,L as selectNodeBackward,X as selectNodeForward,we as selectParentNode,ie as selectTextblockEnd,le as selectTextblockStart,Se as setBlockType,K as splitBlock,re as splitBlockAs,xe as splitBlockKeepMarks,Ae as toggleMark,ye as wrapIn};
//# sourceMappingURL=prosemirror-commands.mjs.map